## 问题二：现用方法说明与与原方法对比（可复现）

### 1. 背景与目标
在问题一的基础上，问题二需在不确定性下（销售量、单产、成本、价格）给出 2024–2030 年稳健的种植方案，并以 CVaR 度量尾部风险，兼顾“收益–风险”权衡。

### 2. 现用方法（本仓库已实现）
- Monte Carlo 场景集：生成 K=1000 个 7 年参数情景（固定随机种子可复现）。
- SAA 求解：从 1000 情景中选取 N_saa∈{30,40,50} 个代表情景建模求解（here-and-now 决策），随后用全部 1000 情景做外部稳健性验证。
- 内生 CVaR：在目标函数中同时最大化期望收益并惩罚 CVaR（损失的条件期望）。采用辅助变量 τ（VaR）与 u_k（超损失），刻画 CVaR 线性化；权衡系数 λ、置信度 α 可调。
- 销售分段入模：显式引入 q_sell、q_excess 及“产销平衡 + 销售上限 + 超产 50% 折价”约束，替代经验性销售率近似。
- 求解器与工具：Python + PuLP(CBC) 建模求解，NumPy/Pandas 场景生成与处理，Matplotlib 可视化；所有图表脚本与输出已给出并可一键复现。

目标函数（损失为 −Profit）：
- 最大化 E[Profit] − λ · CVaR_α(−Profit)
- 以 τ 表示 VaR（损失分位），u_k≥−Profit_k−τ, u_k≥0，CVaR_α = τ + (1/(α·N_saa))·Σ u_k

验证与展示：
- 用 K=1000 全情景计算期望收益、标准差、VaR_5%、CVaR_5%，并生成四张图（风险–收益前沿、收益直方图与VaR/CVaR、SAA 稳健性、λ–α 热力图）。

### 3. 原方法（论文最理想实现）
- 全情景大规模 MILP：将 K=1000 全部纳入同一模型，使用 Gurobi 等商用求解器（含 MIPGap、并行、剪枝与预处理）。
- 优点：数学上最直接、无需 SAA 近似，解与真问题一致；收敛与最优性证据更强。
- 局限：需要商用许可与更强算力；在本环境下受限于“模型规模/许可”而不可行。

### 4. 两种方法对比与结论
- 严谨性：
  - 原方法（全情景 Gurobi）在许可与资源充足时最为严格；
  - 现方法（SAA+内生 CVaR）为公认的一致性近似，N_saa→∞ 时收敛于真问题，且本项目在 1000 情景外部验证下指标稳定。
- 可操作性与可复现：
  - 现方法完全在开源栈下运行，分钟级完成一次求解–验证–制图，脚本化复现强；
  - 原方法在当前环境无法稳定执行。
- 工程可控性：
  - 现方法支持 λ、α、N_saa 的灵敏度扫描与可视化，便于报告撰写与方案沟通；
  - 销售分段、CVaR 内生均已严格入模。

结论：
- 在当前资源与时间约束下，现方法（SAA + 内生 CVaR + 分段销售 + 外部稳健验证）更可落地、可复现，且理论上具备一致性保证；配合四张图的实证验证，已足以支撑高水平（含国奖级）论文展示。
- 若有 Gurobi 商用许可与计算资源，可切换到“全情景”模型以获得更强的最优性保证，但对最终结论的边际提升预计有限（从现有稳定结果与敏感性分析可见）。

### 5. 复现实验与产物
- 风险–收益前沿：`python generate_problem2_fig1_efficient_frontier.py`
- 收益分布与 VaR/CVaR：`python generate_problem2_fig2_profit_distribution.py`
- SAA 稳健性：`python generate_problem2_fig3_saa_robustness.py`
- λ–α 敏感性热力图：`python generate_problem2_fig4_lambda_alpha_heatmap.py`

输出：PNG 图片与 CSV 指标数据已自动生成至项目根目录，便于论文直接引用与附录复现。

### 6. 可进一步加强的方向（可选）
- 更严格的轮作/最小作业单元 0–1 线性化；
- 代表情景的聚类选取或“尾部情景增约/列生成”以加速 CVaR 收敛；
- 对比不同随机种子下的稳健性“误差带”并入附录。


